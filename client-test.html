<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Geofence Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        .box {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        button {
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }

        .btn-danger {
            background-color: #ffcccc;
            border: 1px solid red;
        }

        .btn-safe {
            background-color: #ccffcc;
            border: 1px solid green;
        }

        li {
            margin-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>

<body>
    <h2>ğŸ“ Geofence & Redis Test</h2>

    <div class="box">
        <h3>Simulate Phone GPS</h3>
        <p>Click to send a specific location:</p>

        <button class="btn-safe" onclick="sendSafeLocation()">
            ğŸï¸ Send SAFE Location (Outside)
        </button>

        <button class="btn-danger" onclick="sendDangerLocation()">
            ğŸš¨ Send DANGER Location (Inside Rabin Sq)
        </button>
    </div>

    <div class="box">
        <h3>Parent View (Updates)</h3>
        <p><i>Wait 10 seconds after clicking to see server logs (Redis Buffer)</i></p>
        <ul id="updates"></ul>
    </div>

    <script>
        // --- âš ï¸ ×©×™× ×¤×” ××ª ×”-ID ×”×××™×ª×™ ×©×œ×š ×©×”×¢×ª×§×ª ×§×•×“× ---
        const MY_USER_ID = '4e361274-853c-4158-a60a-a670e99b2c82';
        // ----------------------------------------------------

        const socket = io('http://localhost:3000', {
            query: { userId: MY_USER_ID }
        });

        socket.on('connect', () => {
            addLog('âœ… Connected to server via WebSocket!');
        });

        socket.on('newLocationReceived', (data) => {
            console.log('Update received:', data);
            addLog(`ğŸ“ Update: [${data.latitude}, ${data.longitude}]`);
        });

        // ×¤×•× ×§×¦×™×” ×œ×©×œ×™×—×ª ××™×§×•× ××—×•×¥ ×œ××–×•×¨ (×¡×ª× ×‘×™×)
        function sendSafeLocation() {
            const payload = {
                latitude: 32.0000,
                longitude: 34.0000,
                userId: MY_USER_ID
            };
            socket.emit('updateLocation', payload);
            addLog('ğŸ“¤ Sent SAFE location (waiting for Redis...)');
        }

        // ×¤×•× ×§×¦×™×” ×œ×©×œ×™×—×ª ××™×§×•× ×‘×ª×•×š ×›×™×›×¨ ×¨×‘×™×Ÿ
        // ×”×¤×•×œ×™×’×•×Ÿ ×©×œ× ×• ×”×•× ×¡×‘×™×‘ 32.079-32.081, ××– 32.0800 ×–×” ×‘×•×œ ×‘×××¦×¢
        function sendDangerLocation() {
            const payload = {
                latitude: 32.0800,
                longitude: 34.7810,
                userId: MY_USER_ID
            };
            socket.emit('updateLocation', payload);
            addLog('ğŸ“¤ Sent DANGER location (waiting for Redis...)');
        }

        function addLog(message) {
            const li = document.createElement('li');
            li.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            document.getElementById('updates').prepend(li);
        }
    </script>
</body>

</html>